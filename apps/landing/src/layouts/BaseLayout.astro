---
import SEO from '../components/SEO.astro';

interface Props {
  title: string;
  description: string;
  canonical?: string;
  noindex?: boolean;
  type?: 'website' | 'article';
  publishedTime?: string;
  modifiedTime?: string;
}

const { title, description, canonical, noindex, type = 'website', publishedTime, modifiedTime } = Astro.props;
const pathname = Astro.url.pathname;
const isHome = pathname === '/';
const isBlog = pathname === '/blog' || pathname.startsWith('/blog/');
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title === 'BETA Stack' ? title : `${title} | BETA Stack`}</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,600;0,9..40,700;1,9..40,400&display=swap" rel="stylesheet" />
    <SEO
      title={title}
      description={description}
      canonical={canonical}
      noindex={noindex}
      type={type}
      publishedTime={publishedTime}
      modifiedTime={modifiedTime}
    />
    <style is:global>
      :root { font-family: 'DM Sans', system-ui, sans-serif; }
      /* White shimmer on hover for hero titles */
      .title-shimmer {
        display: inline-block;
        position: relative;
        overflow: hidden;
      }
      .title-shimmer::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(
          90deg,
          transparent 0%,
          transparent 35%,
          rgba(255, 255, 255, 0.45) 50%,
          transparent 65%,
          transparent 100%
        );
        transform: translateX(-100%);
        transition: transform 1s ease;
        pointer-events: none;
      }
      .title-shimmer:hover::after {
        transform: translateX(100%);
      }
      @media (prefers-reduced-motion: reduce) {
        .title-shimmer::after {
          transition: none;
        }
        .title-shimmer:hover::after {
          transform: none;
        }
      }
      .skip-link {
        position: absolute;
        top: -100px;
        left: 0.5rem;
        z-index: 100;
        padding: 0.5rem 1rem;
        background: oklch(var(--p));
        color: oklch(var(--pc));
        font-weight: 600;
        border-radius: 0.375rem;
        transition: top 0.2s;
      }
      .skip-link:focus {
        top: 0.5rem;
        outline: 2px solid oklch(var(--p));
        outline-offset: 2px;
      }
    </style>
  </head>
  <body class="min-h-screen bg-base-100 text-base-content font-sans">
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <header class="sticky top-0 z-10 border-b border-base-300/60 bg-base-100/90 backdrop-blur-md">
      <nav class="container mx-auto px-4 h-12 flex items-center justify-between max-w-5xl" aria-label="Main">
        <a href="/" class="text-sm font-semibold tracking-tight text-base-content hover:opacity-80 transition-opacity focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded">BETA Stack</a>
        <div class="flex items-center gap-6">
          <a href="/" class={`text-sm transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-1 ${isHome ? 'font-semibold text-primary' : 'text-base-content/70 hover:text-base-content'}`} aria-current={isHome ? 'page' : undefined}>Home</a>
          <a href="/blog" class={`text-sm transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded px-1 ${isBlog ? 'font-semibold text-primary' : 'text-base-content/70 hover:text-base-content'}`} aria-current={isBlog ? 'page' : undefined}>Blog</a>
          <label class="flex items-center gap-2 cursor-pointer" title="Toggle theme">
            <span class="text-sm text-base-content/70">Theme</span>
            <input type="checkbox" id="theme-toggle" value="dark" class="toggle toggle-sm theme-controller" aria-label="Toggle dark mode" />
          </label>
        </div>
      </nav>
    </header>
    <main id="main-content" tabindex="-1">
      <slot />
    </main>
    <footer class="footer footer-center p-6 bg-base-200 text-base-content text-sm gap-2">
      <p>BETA Stack â€” Bun, Elysia, Tailwind, Astro</p>
      <a href="/rss.xml" class="link link-hover text-base-content/70 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded">RSS</a>
    </footer>
    <script is:inline>
      (function() {
        var stored = localStorage.getItem('theme');
        var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
        var theme = stored || (prefersDark ? 'dark' : 'light');
        document.documentElement.setAttribute('data-theme', theme);
        var toggle = document.getElementById('theme-toggle');
        if (toggle) {
          toggle.checked = theme === 'dark';
          toggle.addEventListener('change', function() {
            var next = toggle.checked ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', next);
            localStorage.setItem('theme', next);
          });
        }
      })();
    </script>
  </body>
</html>
